"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,i){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self,t.Schart=i())}(void 0,function(){function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function i(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function e(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}function o(t){return a(t)||s(t)||h()}function a(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}function s(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var n=window.devicePixelRatio||1,l=10*n,r=l/2,d=function(t){var i=document.getElementById(t),e=i.parentNode.clientWidth,o=i.parentNode.clientHeight;return i.style.width=e+"px",i.style.height=o+"px",i.width=e*n,i.height=o*n,i},f=function(t,i){var e=t.map(function(t){return t.data.reduce(function(t,i){return t>i?t:i})}),a=Math.ceil(Math.max.apply(Math,o(e))/i),s=a.toString().length-1;return s=s>2?2:s,Math.ceil(a/Math.pow(10,s))*Math.pow(10,s)};return function(){function i(e,o){t(this,i),this.canvas=d(e),this.ctx=this.canvas.getContext("2d"),this.type="bar",this.showValue=!0,this.showGrid=!0,this.topPadding=60*n,this.leftPadding=50*n,this.rightPadding=10*n,this.bottomPadding=50*n,this.yEqual=5,this.yLength=0,this.xLength=0,this.ySpace=0,this.xRorate=0,this.yRorate=0,this.xRotate=0,this.yRotate=0,this.bgColor="#fff",this.axisColor="#666",this.gridColor="#eee",this.title={text:"",color:"#666",position:"top",font:"bold "+18*n+"px Arial",top:l,bottom:r},this.legend={display:!0,position:"top",color:"#666",font:14*n+"px Arial",top:45*n,bottom:15*n,textWidth:0},this.radius=100*n,this.innerRadius=60*n,this.colorList=["#4A90E2","#F5A623","#ff5858","#5e64ff","#2AC766","#743ee2","#b554ff","#199475"],this.init(o)}return e(i,[{key:"init",value:function(t){if(t.title=Object.assign({},this.title,t.title),t.legend=Object.assign({},this.legend,t.legend),Object.assign(this,t),!t.labels||!t.labels.length)throw new Error("缺少主要参数labels");if(!t.datasets||!t.datasets.length)throw new Error("缺少主要参数datasets");this.drawBackground(),"bar"===this.type||"line"===this.type?this.renderBarChart():this.renderPieChart(),this.drawLegend()}},{key:"renderBarChart",value:function(){this.yLength=Math.floor((this.canvas.height-this.topPadding-this.bottomPadding-l)/this.yEqual),this.xLength=Math.floor((this.canvas.width-this.leftPadding-this.rightPadding-l)/this.labels.length),this.ySpace=f(this.datasets,this.yEqual),this.drawXAxis(),this.drawYAxis(),this.drawBarContent()}},{key:"drawBarContent",value:function(){var t=this.ctx,i=this.datasets.length;t.beginPath();for(var e=0;e<i;e++){t.font=this.legend.font,this.legend.textWidth+=Math.ceil(t.measureText(this.datasets[e].label).width),t.fillStyle=t.strokeStyle=this.datasets[e].fillColor||this.colorList[e];for(var o=this.datasets[e].data,a=0;a<o.length;a++)if(!(a>this.labels.length-1)){var s=this.xLength/(i+1),h=this.yLength/this.ySpace,d=this.leftPadding+this.xLength*a+s*(e+.5),f=d+s,c=this.canvas.height-this.bottomPadding,g=c-o[a]*h;if("bar"===this.type)t.fillRect(d,g,f-d,c-g),this.drawValue(o[a],d+s/2,g-r);else if("line"===this.type){var u=this.leftPadding+this.xLength*(a+.5);t.beginPath(),t.arc(u,g,3*n,0,2*Math.PI,!0),t.fill(),0!==a&&(t.beginPath(),t.strokeStyle=this.datasets[e].fillColor||this.colorList[e],t.lineWidth=2*n,t.moveTo(u-this.xLength,c-o[a-1]*h),t.lineTo(u,g),t.stroke(),t.lineWidth=1*n),this.drawValue(o[a],u,g-l)}}}t.stroke()}},{key:"renderPieChart",value:function(){for(var t=this.ctx,i=this.labels.length,e=this.datasets[0],o=e.data,a=o.reduce(function(t,i){return t+i}),s=-Math.PI/2,h=this.canvas.width/2,n=this.canvas.height/2,l=0;l<i;l++){t.font=this.legend.font,this.legend.textWidth+=Math.ceil(t.measureText(this.labels[l]).width),t.beginPath(),t.strokeStyle=t.fillStyle=e.colorList&&e.colorList[l]||this.colorList[l],t.moveTo(h,n);var r=s;s+=o[l]/a*2*Math.PI;var d=s;t.arc(h,n,this.radius,r,d),t.closePath(),t.fill();var f=(r+d)/2;this.drawPieValue(o[l],f)}"ring"===this.type&&(t.beginPath(),t.fillStyle=this.bgColor,t.arc(h,n,this.innerRadius,0,2*Math.PI),t.closePath(),t.fill())}},{key:"drawValue",value:function(t,i,e){var o=this.ctx;this.showValue&&(o.textBaseline="middle",o.font=12*n+"px Arial",o.textAlign="center",o.fillText(t,i,e))}},{key:"drawPieValue",value:function(t,i){var e=this.ctx;if(this.showValue){var o=this.canvas.width/2,a=this.canvas.height/2,s=Math.ceil(Math.abs(this.radius*Math.cos(i))),h=Math.floor(Math.abs(this.radius*Math.sin(i)));e.textBaseline="middle",this.showValue&&(i<=0?(e.textAlign="left",e.moveTo(o+s,a-h),e.lineTo(o+s+l,a-h-l),e.moveTo(o+s+l,a-h-l),e.lineTo(o+s+3*l,a-h-l),e.stroke(),e.fillText(t,o+s+3.5*l,a-h-l)):i>0&&i<=Math.PI/2?(e.textAlign="left",e.moveTo(o+s,a+h),e.lineTo(o+s+l,a+h+l),e.moveTo(o+s+l,a+h+l),e.lineTo(o+s+3*l,a+h+l),e.stroke(),e.fillText(t,o+s+3.5*l,a+h+l)):i>Math.PI/2&&i<Math.PI?(e.textAlign="right",e.moveTo(o-s,a+h),e.lineTo(o-s-l,a+h+l),e.moveTo(o-s-l,a+h+l),e.lineTo(o-s-3*l,a+h+l),e.stroke(),e.fillText(t,o-s-3.5*l,a+h+l)):(e.textAlign="right",e.moveTo(o-s,a-h),e.lineTo(o-s-l,a-h-l),e.moveTo(o-s-l,a-h-l),e.lineTo(o-s-3*l,a-h-l),e.stroke(),e.fillText(t,o-s-3.5*l,a-h-l)))}}},{key:"drawBackground",value:function(){this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawTitle()}},{key:"drawTitle",value:function(){var t=this.title;if(t.text){var i=this.ctx;i.beginPath(),i.font=t.font,i.textAlign="center",i.fillStyle=t.color,"top"===t.position?(i.textBaseline="top",i.fillText(t.text,this.canvas.width/2,t.top)):(i.textBaseline="bottom",i.fillText(t.text,this.canvas.width/2,this.canvas.height-t.bottom))}}},{key:"drawXAxis",value:function(){var t=this.ctx,i=this.canvas.height-this.bottomPadding+.5;t.beginPath(),t.strokeStyle=this.axisColor,t.moveTo(this.leftPadding,i),t.lineTo(this.canvas.width-this.rightPadding,i),t.stroke(),this.drawXPoint()}},{key:"drawXPoint",value:function(){var t=this.ctx;t.beginPath(),t.font=12*n+"px Microsoft YaHei",t.textAlign=this.xRorate||this.xRotate?"right":"center",t.textBaseline="top",t.fillStyle=this.axisColor;for(var i=0;i<this.labels.length;i++){var e=this.labels[i],o=this.leftPadding+this.xLength*(i+1)+.5,a=this.canvas.height-this.bottomPadding;this.showGrid?(t.strokeStyle=this.gridColor,t.moveTo(o,a),t.lineTo(o,this.topPadding+l)):(t.moveTo(o,a),t.lineTo(o,a-r)),t.stroke(),t.save(),t.translate(o-this.xLength/2,a+r),this.xRorate?t.rotate(-this.xRorate*Math.PI/180):t.rotate(-this.xRotate*Math.PI/180),t.fillText(e,0,0),t.restore()}}},{key:"drawYAxis",value:function(){var t=this.ctx;t.beginPath(),t.strokeStyle=this.axisColor,t.moveTo(this.leftPadding-.5,this.canvas.height-this.bottomPadding+.5),t.lineTo(this.leftPadding-.5,this.topPadding+.5),t.stroke(),this.drawYPoint()}},{key:"drawYPoint",value:function(){var t=this.ctx;t.font=12*n+"px Microsoft YaHei",t.textAlign="right",t.textBaseline="middle",t.beginPath();for(var i=0;i<this.yEqual;i++){var e=this.leftPadding,o=this.canvas.height-this.bottomPadding-this.yLength*(i+1)+.5;this.showGrid?(t.strokeStyle=this.gridColor,t.moveTo(e,o),t.lineTo(this.canvas.width-this.rightPadding-l,o)):(t.strokeStyle=this.axisColor,t.moveTo(e-r,o),t.lineTo(e,o)),t.stroke(),t.save(),t.fillStyle=this.axisColor,t.translate(e-l,o),this.yRorate?t.rotate(-this.yRorate*Math.PI/180):t.rotate(-this.xRotate*Math.PI/180),t.fillText(this.ySpace*(i+1),0,0),t.restore()}}},{key:"drawLegend",value:function(){var t=this.legend;if(t.display){var i=this.ctx,e="pie"===this.type||"ring"===this.type;i.beginPath(),i.font=t.font,i.textAlign="left",i.textBaseline="middle";for(var o=e?this.labels.length:this.datasets.length,a=(this.canvas.width-(this.legend.textWidth+(5*o-2)*l))/2,s=0,h=0;h<o;h++){var n=e?this.datasets[0]:this.datasets[h],d=(e?this.labels[h]:n.label)||"";i.fillStyle=n.colorList&&n.colorList[h]||n.fillColor||this.colorList[h],"top"===t.position?(this.drawLegendIcon(a+5*l*h+s,t.top-r,2*l,l),i.fillStyle=t.color,i.fillText(d,a+(5*h+3)*l+s,t.top)):"bottom"===t.position?(this.drawLegendIcon(a+5*l*h+s,this.canvas.height-t.bottom-r,2*l,l),i.fillStyle=t.color,i.fillText(d,a+(5*h+3)*l+s,this.canvas.height-t.bottom)):(i.fillRect(l,t.top+2*l*h,2*l,l),i.fillStyle=t.color,i.fillText(d,4*l,t.top+2*l*h+.5*l)),s+=Math.ceil(i.measureText(d).width)}}}},{key:"drawLegendIcon",value:function(t,i,e,o){var a=this.ctx;"line"===this.type?(a.beginPath(),a.strokeStyle=a.fillStyle,a.lineWidth=2*n,a.moveTo(t,i+r),a.lineTo(t+2*l,i+r),a.stroke(),a.lineWidth=1*n,a.arc(t+l,i+r,3*n,0,2*Math.PI,!0),a.fill()):a.fillRect(t,i,e,o)}}]),i}()});